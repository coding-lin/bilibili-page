import{r as n,n as h,o as b,q as E,v as F,w as L,x as P,j as o,y as R,z as C,d as g,F as x,f as I}from"./index.49bc75a5.js";import{u as M}from"./index.8e5b60dc.js";import{D as k}from"./index.31f27427.js";function N(t){var e=this,r=n.exports.useRef(!1);return n.exports.useCallback(function(){for(var l=[],c=0;c<arguments.length;c++)l[c]=arguments[c];return h(e,void 0,void 0,function(){var u,f;return b(this,function(i){switch(i.label){case 0:if(r.current)return[2];r.current=!0,i.label=1;case 1:return i.trys.push([1,3,,4]),[4,t.apply(void 0,E([],F(l),!1))];case 2:return u=i.sent(),r.current=!1,[2,u];case 3:throw f=i.sent(),r.current=!1,f;case 4:return[2]}})})},[t])}function j(t){return t===window}const S="adm-infinite-scroll",_={threshold:250,children:(t,e,r)=>o(D,{hasMore:t,failed:e,retry:r})},B=t=>{const e=L(_,t),[r,l]=n.exports.useState(!1),c=N(a=>h(void 0,void 0,void 0,function*(){try{yield e.loadMore(a)}catch(s){throw l(!0),s}})),u=n.exports.useRef(null),[f,i]=n.exports.useState({}),p=n.exports.useRef(f),[d,w]=n.exports.useState(),{run:m}=M(()=>h(void 0,void 0,void 0,function*(){if(p.current!==f||!e.hasMore)return;const a=u.current;if(!a||!a.offsetParent)return;const s=R(a);if(w(s),!s)return;const T=a.getBoundingClientRect().top;if((j(s)?window.innerHeight:s.getBoundingClientRect().bottom)>=T-e.threshold){const v={};p.current=v,yield c(!1),i(v)}}),{wait:100,leading:!0,trailing:!0});n.exports.useEffect(()=>{m()}),n.exports.useEffect(()=>{if(!u.current||!d)return;function s(){m()}return d.addEventListener("scroll",s),()=>{d.removeEventListener("scroll",s)}},[d]);function y(){return h(this,void 0,void 0,function*(){l(!1),yield c(!0),i(p.current)})}return P(e,o("div",{className:S,ref:u,children:typeof e.children=="function"?e.children(e.hasMore,r,y):e.children}))},D=t=>{const{locale:e}=C();return t.hasMore?t.failed?g("span",{children:[o("span",{className:`${S}-failed-text`,children:e.InfiniteScroll.failedToLoad}),o("a",{onClick:()=>{t.retry()},children:e.InfiniteScroll.retry})]}):g(x,{children:[o("span",{children:e.common.loading}),o(k,{})]}):o("span",{children:e.InfiniteScroll.noMore})};var O=B;const V=({top:t})=>{const[e,r]=n.exports.useState(!1),l=I(()=>{(window.pageYOffset||document.body.scrollTop||document.documentElement.scrollTop||0)>t?r(!0):r(!1)},100);return n.exports.useEffect(()=>(document.addEventListener("scroll",l,!0),()=>document.removeEventListener("scroll",l)),[e]),o(x,{children:e&&o("div",{className:"to-top",onClick:()=>window.scrollTo(0,0),children:o("i",{className:"iconfont icon-fanhuijiantou"})})})};export{O as I,V as S};
